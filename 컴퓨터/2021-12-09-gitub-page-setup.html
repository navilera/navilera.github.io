<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <title>
        
            Github page 블로그 설정, 카테고리 삽질
        
    </title>

    <meta name='robots' content='index,follow'>
    <meta name='revisit-after' content='1 days'>

    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name='HandheldFriendly' content='True'>
    <meta name='MobileOptimized' content='320'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
    <meta http-equiv='cleartype' content='on'>

    
        <link rel='stylesheet' href='https://navilera.com/assets/css/syntax.css' type='text/css'>
    
    
    <link rel='stylesheet' href='https://navilera.com/assets/css/minimal-block.css' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <link rel='alternate' type='application/rss+xml' title='Navilera' href='https://navilera.com/feed.xml'>

</head>

<body>
    <header id='top' class='main-header'>

        <div class='module title color-1'>
            <h1><a href='https://navilera.com/'>Navilera</a></h1>
        </div>

        <div class='module description color-2'>
            <a href='https://navilera.com/about/'>Manwoo Yi</a>
        </div>

        <nav class='module main-menu color-4'>
        
            <a href='https://navilera.com/categories/컴퓨터'>컴퓨터</a>
            <br>
        
            <a href='https://navilera.com/categories/세벌식'>세벌식</a>
            <br>
        
        </nav>

    </header>

    <div id='top' class="main-content">
   
    <article class="module color-3">
       
        <h1>Github page 블로그 설정, 카테고리 삽질</h1>
		<span class='categories'>2021-12-09 12:40 컴퓨터</span>		
        <div class='separator'></div>
        

        <p>Github에 page라는 기능을 이용해서 블로그를 만들 수 있다는 것은 많이 알려진 사실이다. 그리고 github는 자체적으로 jekyll이라는 루비 기반 랜더링 엔진을 지원한다. 그래서 그냥 jekyll 기반 필수 파일들(블로그 포스트, 탬플릿 디자인)만 올려 놓으면 github에서 알아서 랜더링해서 정적 페이지 기반 블로그를 만들어 준다. 매력적인 기능이다. 게다가 개인의 도메인까지 연결해 준다.</p>

<h3 id="왜">왜?</h3>
<p>나는 십여년 전 부터 내 아이디로 쓰고 있는 나빌레라로 닷컴 도메인을 보유하고 있다. navilera.com이다. 그냥 남이 쓰는 것이 싫어서 매년 2만원씩 돈 써가면서 유지하고 있다. 가끔 이 도메인으로 웹 페이지 같은것을 만들었다가 다시 닫곤 했다. 이번에 또 반복했다. navilera.com으로 github page 블로그를 만들었다.</p>

<p>이미 많은 사람들이 쓰고 있는 것이므로 세팅 방법을 찾는 것은 어렵지 않았다. 한글로 된 자료도 많다. 다만 대부분 자료가 초보에 맞춰져 있다 보니까, 테마 찾아서 설정하고 글 올리는 방법에 치중해 있다는게 문제다.</p>

<h3 id="무슨-삽질을-한건가">무슨 삽질을 한건가?</h3>
<p>사람들이 많이 쓰는 minimal-mistake라는 테마가 있다. 이름을 보아하니 처음엔 minimal이었을 것 같으나 이제 더이상 minimal이 아닌 테마다. 설정이 존나 복잡하고 그만큼 다양하게 커스터마이징이 가능하다. 다시 말해 복잡하다. 그래서 복잡한 것을 제외하고 아주 간단한 테마를 선택했다.</p>

<p>그 테마가 지금 이 블로그의 테마다. minimal-block이라는 테마인데 진짜 minimal이다. 아무런 기능도 커스터마이징도 없다. 그래서 내가 직접 구성을 파악하고 코딩해서 바꾸기 딱 좋았다. 복잡하게 만들어 놔서 설정으로 구성을 바꾸는 것보다 그냥 코딩해서 소스 고치는게  나에게는 더 편하다.</p>

<p>기본 테마를 구성하고 몇 개 불필요한 요소를 제거하고 나니, 뭔가 허전해서, 카테고리별로 포스트를 모아 놓은 페이지를 만들고 싶었다. 난 당연히 쉽게 될 줄 알았다.</p>

<p>그런데 jekyll은 기본 기능으로 사이트 전체의 카테고리를 가져올 수는 있지만 카테고리만 따로 뽑아서 페이지를 구성하는것이 안된다. 아니면 내가 방법을 못 찾았을 것이다. 잠깐 찾아보니 대부분 jekyll을 이용한 블로그는 그냥 전체 카테고리를 페이지에 뿌리고 북마크로 찾아가는 방식을 쓰고 있었다. 나도 그냥 그렇게 했으면 됐는데, 난 내가 딱 원하는 방식으로 어떻게든 만들고 싶었다.</p>

<p>그렇게 삽질은 시작된거지.</p>

<h3 id="카테고리-url-만들기">카테고리 URL 만들기</h3>
<p>아주 고전적으로 블로그 네비게이션 패널에 개별 카테고리로 들어가는 링크를 만들고 싶었다. 2000년대 초반 스타일이다.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">	
	{% for category in site.categories %}
	    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'{{ site.url }}/categories/{{ category[0] }}'</span><span class="nt">&gt;</span>{{ category[0] }}<span class="nt">&lt;/a&gt;</span>
	    <span class="nt">&lt;br&gt;</span>
	{% endfor %}
	
	</code></pre></figure>

<p>간단한 코드다.</p>

<p>이러면 예를 들어 블로그에 ‘컴퓨터’, ‘개발’ 이렇게 두 카테고리가 있다고 했을 때,</p>

<ul>
  <li>navilera.com/categories/컴퓨터</li>
  <li>navilera.com/categories/개발</li>
</ul>

<p>이렇게 링크를 생성한다.</p>

<p>문제는 저 ‘categories’라는 중간 URL을 처리하는 방법을 직접 구현해야 한다는 것이다.</p>

<p>대충 구조를 보고 나는 그냥 _layout 폴더에 categories.html이라는 파일을 하나 만들면 알아서 될 줄 알았다. 그러나 그렇게 단순하게 동작하지 않았다. 그런데 그렇게 단순하게 동작해야 하지 않나? 뭐든 사용자가 직관적으로 기대한 동작이 바로되야 훌륭한 소프트웨어인 것이다. 그런 관점에서 아직 jekyll은 좀 발전 가능성이 남았다고 할 수 있을까.</p>

<p>별 삽질을 다 해본 결과 가장 빠른 해결 방법은 내가 플러그인을 직접 만들어 넣는 것이다. 물론 내가 플러그인을 코딩하진 않았다. 그럴만한 열정은 없다. 인터넷에서 플러그인 코드를 긁어다가 넣었다. 이런것이 스크립트 스크랩퍼인가 싶다.</p>

<p>_plugins라는 폴더를 만들고 거기에 categories.rb라는 이름으로 아래 코드를 저장하면 된다.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">	<span class="k">module</span> <span class="nn">Jekyll</span>
	  <span class="k">class</span> <span class="nc">CategoryPageGenerator</span> <span class="o">&lt;</span> <span class="no">Generator</span>
	    <span class="n">safe</span> <span class="kp">true</span>

	    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
	      <span class="k">if</span> <span class="n">site</span><span class="p">.</span><span class="nf">layouts</span><span class="p">.</span><span class="nf">key?</span> <span class="s1">'category_index'</span>
		<span class="n">dir</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">config</span><span class="p">[</span><span class="s1">'category_dir'</span><span class="p">]</span> <span class="o">||</span> <span class="s1">'categories'</span>
		<span class="n">site</span><span class="p">.</span><span class="nf">categories</span><span class="p">.</span><span class="nf">each_key</span> <span class="k">do</span> <span class="o">|</span><span class="n">category</span><span class="o">|</span>
		  <span class="n">site</span><span class="p">.</span><span class="nf">pages</span> <span class="o">&lt;&lt;</span> <span class="no">CategoryPage</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">site</span><span class="p">.</span><span class="nf">source</span><span class="p">,</span> <span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">category</span><span class="p">),</span> <span class="n">category</span><span class="p">)</span>
		<span class="k">end</span>
	      <span class="k">end</span>
	    <span class="k">end</span>
	  <span class="k">end</span>

	  <span class="c1"># A Page subclass used in the `CategoryPageGenerator`</span>
	  <span class="k">class</span> <span class="nc">CategoryPage</span> <span class="o">&lt;</span> <span class="no">Page</span>
	    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
	      <span class="vi">@site</span> <span class="o">=</span> <span class="n">site</span>
	      <span class="vi">@base</span> <span class="o">=</span> <span class="n">base</span>
	      <span class="vi">@dir</span>  <span class="o">=</span> <span class="n">dir</span>
	      <span class="vi">@name</span> <span class="o">=</span> <span class="s1">'index.html'</span>

	      <span class="nb">self</span><span class="p">.</span><span class="nf">process</span><span class="p">(</span><span class="vi">@name</span><span class="p">)</span>
	      <span class="nb">self</span><span class="p">.</span><span class="nf">read_yaml</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">'_layouts'</span><span class="p">),</span> <span class="s1">'category_index.html'</span><span class="p">)</span>
	      <span class="nb">self</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="s1">'category'</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>

	      <span class="n">category_title_prefix</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">config</span><span class="p">[</span><span class="s1">'category_title_prefix'</span><span class="p">]</span> <span class="o">||</span> <span class="s1">'Category: '</span>
	      <span class="nb">self</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">category_title_prefix</span><span class="si">}#{</span><span class="n">category</span><span class="si">}</span><span class="s2">"</span>
	    <span class="k">end</span>
	  <span class="k">end</span>
	<span class="k">end</span>
	</code></pre></figure>

<p>정확한건 모르겠다. 대충 코드를 해석하면 jekyll이 페이지에 전달하는 page 객체에 ‘category’라는 key를 하나 만들고 거기에 URL에서 받은 문자열을 넣어주는 것으로 보인다.</p>

<p>그래서</p>

<blockquote>
  <p>navilera.com/categories/카테고리이름</p>
</blockquote>

<p>이렇게 URL을 입력하면 categoriy_index.html 파일로 ‘카테고리이름’을 page.category에 넣어서 보내주는 것이다.</p>

<p>그러면 category_index.html을 _layout 폴더에 만든다 코드는 아래와 같다.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">	
	---
	layout: default
	---

	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-content"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">"module color-3"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;h1&gt;</span>{{ page.category }}<span class="nt">&lt;/h1&gt;</span>
		<span class="nt">&lt;hr&gt;</span>
	    {% for post in site.posts %}
			{% if post.categories contains page.category %}
		<span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">'module color-3'</span><span class="nt">&gt;</span>
		    <span class="nt">&lt;header&gt;</span>
		        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'categories'</span><span class="nt">&gt;</span>{{post.date | date: "%F %R" }} {{ post.categories | array_to_sentence_string }}<span class="nt">&lt;/span&gt;</span>
		        
		        <span class="nt">&lt;h2&gt;</span>
		            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'{{ fullUrl }}{{ post.url }}'</span> <span class="na">title=</span><span class="s">'{{ post.title }}'</span><span class="nt">&gt;</span>
		                {{ post.title }}
		            <span class="nt">&lt;/a&gt;</span>
		        <span class="nt">&lt;/h2&gt;</span>
		        
		        
		    <span class="nt">&lt;/header&gt;</span>
		    
		    <span class="nt">&lt;p&gt;</span>{{ post.excerpt | strip_html | truncate: 250 }}<span class="nt">&lt;/p&gt;</span>
		        
		<span class="nt">&lt;/article&gt;</span>
			{% endif %}
	    {% endfor %}
	<span class="nt">&lt;/article&gt;</span>
	
	</code></pre></figure>

<p>해당 동작을 하는 코드를 작성할 능력은 안되도 대충 보고 해석할 능력은 되기에 짜집기 했다. 간단하다. page.category에는 URL에서 받은 카테고리 이름이 들어가 있다. site.posts는 전체 포스트 객체를 모두 리턴한다. 그래서 post.categories에는 해당 포스트가 소속된 카테고리 목록이 나온다. 이 목록에 page.category가 포함되는지 여부를 따져서 특정 카테고리에 속한 포스트만 나오게 하는 것이다. 매우 비효율적인 코드이지만 어차피 정적 빌드 할 것이기 때문에 상관없다. 또한 내가 블로그에 글을 몇 십만개 쓸것도 아니기 때문에 아마도 성능 문제는 전혀 없을 것이다.</p>

<p>이러면 내가 의도했던 특정 카테고리에 속하는 글만 따로 뽑아서 리스트를 페이지에 뿌릴 수 있다.</p>

<h3 id="github는-커스텀-플러그인이-안되네">github는 커스텀 플러그인이 안되네</h3>
<p>여기까지 작업하고 로컬에서 테스트한 다음 기분 좋게 github에 올렸다. 그러나 결과는 기대한대로 동작하지 않았다. github는 github에서 허가한 플러그인만 동작한다고 한다. 보안 문제가 있을 수 있으니 그럴 수 있다고 생각한다. 흠… 그러면 대안을 찾아야지.</p>

<p>찾아보니까 설정등을 만져서 커스텀 플러그인이 동작하게 만드는 방법은 없었다.  찾아본 대안은 github에서 jekyll로 랜더링하는 것이 아니라 로컬에서 랜더링을 끝낸 다음 생성한 정적 파일들을 github로 올리는 것이다. github에는 랜더링 결과만 올려서 유지하거나, 소스까지 github에 올려서 유지하는 방법 중 하나를 선택했다. 귀찮아서 소스는 로컬에 놓고 github에는 랜더링 결과 정적 파일들만 올릴까도 생각했지만 이왕 하는거 소스도 올리기로 결정했다.</p>

<p>그러면 소스는 어떻게 관리할 것인지를 결정해야 한다. 저장소를 하나 더 만들어서 거기서는 소스만 관리하고 랜더링을 해서 랜더링 결과 파일들을 블로그 저장소로 복사하는 식이다. 아니면 저장소 하나에서 브랜치를 만들어서 소스를 관리하는 방법도 있다. 나는 브랜치를 만들어서 관리하기로 결정했다.</p>

<p>절차는 이러하다.</p>

<ol>
  <li>main 브랜치와 source 브랜치를 유지한다.</li>
  <li>source 브랜치에 jekyll raw 파일을 관리한다. 블로그 포스트는 여기서 작성한다.</li>
  <li>블로그 작성을 하고 나면 source 브랜치에서 jekyll build 명령으로 랜더링한다. 그러면 _site 폴더가 생긴다.</li>
  <li>_site 폴더의 내용을 main 브렌치로 옮긴다.</li>
  <li>모두 push 한다.</li>
</ol>

<p>이러하다. 나는 git 명령어 만으로 source 브랜치의 _site 폴더 내용을 main 브렌치의 root 옮기고 싶었으나 내가 git 활용 능력이 떨어져서 git 명령어 만으로 하는 방법을 찾지 못하였다. 그래서 그냥 mv, cp 등을 조합해서 스크립트로 만들었다.</p>

<h3 id="결론">결론</h3>
<p>결국엔 github page의 jekyll 실시간 랜더링 기능은 쓰지 못하고 로컬에서 랜더링해서 정적 파일을 github page 저장소에 올리는 식으로 이 블로그를 운영하게 됐다. 이럴꺼면 왜 Jekyll로 삽질했나 싶다. 다른 정적 블로그 만들어 주는 툴도 많은데…</p>

        
        <p class="top"><small><a href="#top">[top]</a></small></p>
        
    </article>
</div>





    <div class="footer module">
	<span class="licence">Copyright 2021 Modified by Manwoo Yi</span>
    <p>
        Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyllrb</a>.
        Powered by <a href="https://github.com/drvy/minimal-block" target="_blank">minimal-block theme.</a>
    </p>
</div>


</body>
</html>
